---
title: "Cophylogenetic simulation"
author: "Wade Dismukes"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Cophylogenetic simulation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This vignette summarizes the workflow for simulating a host and symbiont tree using the `sim_cophylo_bdp` function. 

## Introduction


## Figuring out parameters and what they mean

This model has a number of parameters that are input into the `sim_cophylo_bdp` function. Let us assume that we just want to simulate to a time of 2.0 units. We can then use `calculate_expected_leaves_sptree` and `calculate_expected_leaves_symbtree` to figure out the average number of extant tips that will be on our host and symbiont trees respectively. 


```{r}
library(treeducken)
set.seed(42)
exp_tips_host <- calculate_expected_leaves_sptree(1.0,0.5,2.0)
# on average we will get about 5 tips
# maybe we want something more like 8, so let's decrease the extinction rate
exp_tips_host <- calculate_expected_leaves_sptree(1.0, 0.3, 2.0)
# that looks about right, let's assume there are no host speciations that are not speciations
h_lambda <- 1.0
h_mu <- 0.3
c_lambda <- 0.0
# now we need to worry about the symbiont tree
exp_tips_symb <- calculate_expected_leaves_locustree(t = 2.0, 0.1, 0.0, 8)
# a little less than 10 symbiont tips on average
s_lambda <- 1.0
s_mu <- 0.3
# let's also assume there is a chance of about 2/5 of every symbiont speciation resulting in the symbiont colonizing a new host
s_her <- 0.0
```
Now we have all the necessary parameters set with some idea of what they mean. 

## Simulating a set of host and symbiont pairs

```{r}
# simulate 10 paired trees with our set parameters.
host_symb_sets <- sim_cophylo_bdp(hbr = h_lambda,
                hdr = h_mu,
                sbr = s_lambda,
                cosp_rate = c_lambda,
                sdr = s_mu,
                host_exp_rate = s_her,
                timeToSimTo = 2.0,
                numbsim = 10)
host_symb_sets_2 <- sim_cophylo_bdp(hbr = h_lambda,
                hdr = h_mu,
                sbr = s_lambda,
                cosp_rate = c_lambda,
                sdr = s_mu,
                host_exp_rate = s_her,
                timeToSimTo = 2.0,
                numbsim = 10)



```

## Examining the result & plotting some trees
```{r}
# # plot one or two of them
# plot_paired_trees_with_associations(host_symb_sets[[1]])
# host_tree <- host_symb_sets[[1]]$host_tree
# symb_tree <- host_symb_sets[[1]]$symb_tree
# A <- host_symb_sets[[1]]$association_mat
# d <- parafit_stat(host_tr = host_tree, symb_tr = symb_tree, assoc_mat = A)
# parafit_test(host_tr =host_tree, symb_tr =symb_tree, assoc_mat = A, D = d, reps = 999)
```


```{r}
# use cophylo_summary_stat
# host_symb_summary_df <- cophylo_summary_stat(host_symb_sets)
```


## Examining historical associations

Due to issues in the historical association function this part has yet to be 
completed.

